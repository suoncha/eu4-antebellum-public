ab_enable_branching_mission_review = {
	if = {
		limit = { ai = yes }
		country_event = { id = $ai_event_id$ }
	}
	else = {
		custom_tooltip = BYZ_unlock_branches_decision
		hidden_effect = {
			set_country_flag = can_choose_$key$_branching_missions
			change_variable = {
				which = ab_can_preview_missions_var
				value = 1
			}
		}
	}
}


ab_select_current_missions = {
	hidden_effect = {
		clr_country_flag = can_choose_$key$_branching_missions
		change_variable = {
			which = ab_can_preview_missions_var
			value = -1
		}
	}
	ab_select_current_missions_$key$ = yes
}
ab_select_current_branch = {
	custom_tooltip = BYZ_end_preview
	# AB [[[
	if = {
		limit = { ab_can_preview_mission_of_key = { key = AB_LIT } }
		ab_select_current_missions = { key = AB_LIT }
	}
	if = {
		limit = { ab_can_preview_mission_of_key = { key = AB_SEL_LEGALISM_MYSTICISM_NOTMUSLIM } }
		ab_select_current_missions = { key = AB_SEL_LEGALISM_MYSTICISM_NOTMUSLIM }
	}
	if = {
		limit = { ab_can_preview_mission_of_key = { key = AB_SEL_ARAB_TURAN } }
		ab_select_current_missions = { key = AB_SEL_ARAB_TURAN }
	}
	if = {
		limit = { ab_can_preview_mission_of_key = { key = AB_GLH_TATARIA_HORDE } }
		ab_select_current_missions = { key = AB_GLH_TATARIA_HORDE }
	}
	if = {
		limit = { ab_can_preview_mission_of_key = { key = AB_GLH_FAITH_QUESTION } }
		ab_select_current_missions = { key = AB_GLH_FAITH_QUESTION }
	}
	if = {
		limit = { ab_can_preview_mission_of_key = { key = AB_SCO_ALBA_GAELDOM_SCOTLAND } }
		ab_select_current_missions = { key = AB_SCO_ALBA_GAELDOM_SCOTLAND }
	}
	# ]]]
}

ab_clear_all_branching_flags = {
	# AB [[[
	if = {
		limit = { ab_can_preview_mission_of_key = { key = AB_LIT } }
		clr_country_flag = lithuania_pagan_path
		clr_country_flag = lithuania_catholic_path
		clr_country_flag = lithuania_orthodox_path
	}
	if = {
		limit = { ab_can_preview_mission_of_key = { key = AB_SEL_LEGALISM_MYSTICISM_NOTMUSLIM } }
		clr_country_flag = tur_chose_legalism
		clr_country_flag = tur_chose_mysticism
		clr_country_flag = tur_non_muslim_path_flag
	}
	if = {
		limit = { ab_can_preview_mission_of_key = { key = AB_SEL_ARAB_TURAN } }
		clr_country_flag = seljuk_arab
		clr_country_flag = seljuk_turan
	}
	if = {
		limit = { ab_can_preview_mission_of_key = { key = AB_GLH_TATARIA_HORDE } }
		clr_country_flag = glh_european_tree
		clr_country_flag = glh_horde_tree
	}
	if = {
		limit = { ab_can_preview_mission_of_key = { key = AB_GLH_FAITH_QUESTION } }
		clr_country_flag = glh_picked_orthodox
		clr_country_flag = glh_picked_sunni
		clr_country_flag = glh_picked_buddhist
		clr_country_flag = glh_picked_tengri
		clr_country_flag = glh_picked_judaism
		clr_country_flag = glh_picked_nestorian
	}
	if = {
		limit = { ab_can_preview_mission_of_key = { key = AB_SCO_ALBA_GAELDOM_SCOTLAND } }
		clr_country_flag = kingdom_alba
		clr_country_flag = kingdom_gaeldom
		clr_country_flag = kingdom_scotland
	}
	# ]]]
}

ab_preview_mission_branch_1 = {
	# AB [[[
	if = {
		limit = { ab_can_preview_mission_of_key = { key = AB_LIT } }
		set_country_flag = lithuania_pagan_path
		custom_tooltip = lithuania_pagan_path_preview_tt
	}
	if = {
		limit = { ab_can_preview_mission_of_key = { key = AB_SEL_LEGALISM_MYSTICISM_NOTMUSLIM } }
		set_country_flag = tur_chose_legalism
		custom_tooltip = tur_chose_legalism_preview_tt
	}
	if = {
		limit = { ab_can_preview_mission_of_key = { key = AB_SEL_ARAB_TURAN } }
		set_country_flag = seljuk_arab
		custom_tooltip = ab_seljuk_arab_preview_tt
	}
	if = {
		limit = { ab_can_preview_mission_of_key = { key = AB_GLH_TATARIA_HORDE } }
		set_country_flag = glh_european_tree
		custom_tooltip = glh_european_tree_preview_tt
	}
	if = {
		limit = { ab_can_preview_mission_of_key = { key = AB_GLH_FAITH_QUESTION } }
		set_country_flag = glh_picked_orthodox
		custom_tooltip = glh_picked_orthodox_preview_tt
	}
	if = {
		limit = { ab_can_preview_mission_of_key = { key = AB_SCO_ALBA_GAELDOM_SCOTLAND } }
		set_country_flag = kingdom_alba
		custom_tooltip = kingdom_alba_preview_tt
	}
	# ]]]
}

ab_preview_mission_branch_2 = {
	# AB [[[
	if = {
		limit = { ab_can_preview_mission_of_key = { key = AB_LIT } }
		set_country_flag = lithuania_orthodox_path
		custom_tooltip = lithuania_orthodox_path_preview_tt
	}
	if = {
		limit = { ab_can_preview_mission_of_key = { key = AB_SEL_LEGALISM_MYSTICISM_NOTMUSLIM } }
		set_country_flag = tur_chose_mysticism
		custom_tooltip = tur_chose_mysticism_preview_tt
	}
	if = {
		limit = { ab_can_preview_mission_of_key = { key = AB_SEL_ARAB_TURAN } }
		set_country_flag = seljuk_turan
		custom_tooltip = ab_seljuk_turan_preview_tt
	}
	if = {
		limit = { ab_can_preview_mission_of_key = { key = AB_GLH_TATARIA_HORDE } }
		set_country_flag = glh_horde_tree
		custom_tooltip = glh_horde_tree_preview_tt
	}
	if = {
		limit = { ab_can_preview_mission_of_key = { key = AB_GLH_FAITH_QUESTION } }
		set_country_flag = glh_picked_sunni
		custom_tooltip = glh_picked_sunni_preview_tt
	}
	if = {
		limit = { ab_can_preview_mission_of_key = { key = AB_SCO_ALBA_GAELDOM_SCOTLAND } }
		set_country_flag = kingdom_gaeldom
		custom_tooltip = kingdom_gaeldom_preview_tt
	}
	# ]]]
}
ab_preview_mission_branch_3 = {
	# AB [[[
	if = {
		limit = { ab_can_preview_mission_of_key = { key = AB_LIT } }
		set_country_flag = lithuania_catholic_path
		custom_tooltip = lithuania_catholic_path_preview_tt
	}
	if = {
		limit = { ab_can_preview_mission_of_key = { key = AB_SEL_LEGALISM_MYSTICISM_NOTMUSLIM } }
		set_country_flag = tur_non_muslim_path_flag
		custom_tooltip = tur_non_muslim_path_flag_preview_tt
	}
	if = {
		limit = { ab_can_preview_mission_of_key = { key = AB_GLH_FAITH_QUESTION } }
		set_country_flag = glh_picked_buddhist
		custom_tooltip = glh_picked_buddhist_preview_tt
	}
	if = {
		limit = { ab_can_preview_mission_of_key = { key = AB_SCO_ALBA_GAELDOM_SCOTLAND } }
		set_country_flag = kingdom_scotland
		custom_tooltip = kingdom_scotland_preview_tt
	}
	# ]]]
}
ab_preview_mission_branch_4 = {
	if = {
		limit = { ab_can_preview_mission_of_key = { key = AB_GLH_FAITH_QUESTION } }
		set_country_flag = glh_picked_tengri
		custom_tooltip = glh_picked_tengri_preview_tt
	}
}
ab_preview_mission_branch_5 = {
	if = {
		limit = { ab_can_preview_mission_of_key = { key = AB_GLH_FAITH_QUESTION } }
		set_country_flag = glh_picked_judaism
		custom_tooltip = glh_picked_judaism_preview_tt
	}
}
ab_preview_mission_branch_6 = {
	if = {
		limit = { ab_can_preview_mission_of_key = { key = AB_GLH_FAITH_QUESTION } }
		set_country_flag = glh_picked_nestorian
		custom_tooltip = glh_picked_nestorian_preview_tt
	}
}
ab_preview_mission_branch = {
	ab_clear_all_branching_flags = yes
	ab_preview_mission_branch_$branch$ = yes
	hidden_effect = { swap_non_generic_missions = yes }
}

ab_select_current_missions_AB_LIT = {
	if = {
		limit = {
			has_country_flag = lithuania_orthodox_path
		}
		custom_tooltip = AB_EMPTY

		change_tag = LTV
		change_religion = orthodox
		swap_free_idea_group = yes
		capital_scope = { change_religion = orthodox }
		add_country_modifier = {
			name = "gh_conversion"
			duration = 3650
		}
	}
	else_if = {
		limit = { has_country_flag = lithuania_catholic_path }
		custom_tooltip = AB_EMPTY
		
		change_tag = LTV
		override_country_name = LIT
		change_religion = catholic
		swap_free_idea_group = yes
		capital_scope = { change_religion = catholic }
		add_country_modifier = {
			name = "gh_conversion"
			duration = 3650
		}
	}
}

ab_select_current_missions_AB_SEL_LEGALISM_MYSTICISM_NOTMUSLIM = {
	if = {
		limit = { has_country_flag = tur_chose_legalism }
		custom_tooltip = AB_EMPTY

		add_country_modifier = {
			name = tur_embraced_legalism_modifier
			duration = 18250
		}
	}
	else_if = {
		limit = { has_country_flag = tur_chose_mysticism }
		custom_tooltip = AB_EMPTY
		
		add_country_modifier = {
			name = tur_embraced_mysticism_modifier
			duration = 18250
		}
	}
}

ab_select_current_missions_AB_SEL_ARAB_TURAN = {
	if = {
		limit = { has_country_flag = seljuk_arab }
		custom_tooltip = AB_EMPTY

		custom_tooltip = SELJUK_ARABIZATION
		hidden_effect = { move_turkish_into_levantine_group = yes }

		custom_tooltip = AB_EMPTY

		maghreb_region = {
			limit = {
				NOT = { is_core = ROOT }
				NOT = {  is_permanent_claim = ROOT }
			}
			add_permanent_claim = ROOT
		}
	}
	else_if = {
		limit = { has_country_flag = seljuk_turan }
		custom_tooltip = AB_EMPTY
		
		custom_tooltip = SELJUK_TURAN
		
		custom_tooltip = AB_EMPTY

		crimea_region = {
			limit = {
				NOT = { is_core = ROOT }
				NOT = {  is_permanent_claim = ROOT }
			}
			add_permanent_claim = ROOT
		}
		caucasia_region = {
			limit = {
				NOT = { is_core = ROOT }
				NOT = {  is_permanent_claim = ROOT }
			}
			add_permanent_claim = ROOT
		}
		ruthenia_region = {
			limit = {
				NOT = { is_permanent_claim = ROOT	}
				NOT = { is_core = ROOT	}
			}
			add_claim = ROOT
		}
		russia_region = {
			limit = {
				NOT = { is_permanent_claim = ROOT	}
				NOT = { is_core = ROOT	}
			}
			add_claim = ROOT
		}
		ural_region = {
			limit = {
				NOT = { is_permanent_claim = ROOT	}
				NOT = { is_core = ROOT	}
			}
			add_permanent_claim = ROOT
		}

	}
}

ab_select_current_missions_AB_GLH_TATARIA_HORDE = {
	set_country_flag = glh_can_convert
	clr_country_flag = glh_unlocked_mission_tree

	if = {
		limit = { has_country_flag = glh_european_tree }
		custom_tooltip = AB_EMPTY
		
		custom_tooltip = GLH_EUROPEAN_TREE

		custom_tooltip = AB_EMPTY

		override_country_name = TATARIA
		hidden_effect = {
			change_government = monarchy
		}
		swap_free_idea_group = yes
		add_government_reform = tataria_kingdom
		hidden_effect = {
			change_estate_land_share = {
				estate = estate_nomadic_tribes
				share = -50
			}
		}
	}
	else_if = {
		limit = { has_country_flag = glh_horde_tree }
		custom_tooltip = AB_EMPTY

		custom_tooltip = GLH_HORDE_TREE
	}
}

ab_select_current_missions_AB_GLH_FAITH_QUESTION = {
	clr_country_flag = glh_can_convert

	custom_tooltip = AB_EMPTY
	
	if = {
		limit = {
			has_country_flag = glh_picked_orthodox
		}
		change_religion = orthodox
		capital_scope = {
			change_religion = orthodox
		}
		add_country_modifier = {
			name = "gh_conversion"
			duration = 3650
		}
	}
	else_if = {
		limit = { has_country_flag = glh_picked_sunni }
		change_religion = sunni
		capital_scope = {
			change_religion = sunni
		}
		add_country_modifier = {
			name = "gh_conversion"
			duration = 3650
		}
	}
	else_if = {
		limit = { has_country_flag = glh_picked_buddhist }
		change_religion = vajrayana
		capital_scope = {
			change_religion = vajrayana
		}
		hidden_effect = {
			add_prestige = 100
			add_stability = 1
		}
	}
	else_if = {
		limit = { has_country_flag = glh_picked_tengri }
		add_stability = 1
	}
	else_if = {
		limit = { has_country_flag = glh_picked_judaism }
		change_religion = jewish
		capital_scope = {
			change_religion = jewish
		}
		add_country_modifier = {
			name = "gh_conversion"
			duration = 3650
		}
	}
	else_if = {
		limit = {
			has_country_flag = glh_picked_nestorian
		}
		change_religion = nestorian
		capital_scope = {
			change_religion = nestorian
		}
		add_country_modifier = {
			name = "gh_conversion"
			duration = 3650
		}
	}

	set_country_flag = glh_has_picked_religion
}

ab_select_current_missions_AB_SCO_ALBA_GAELDOM_SCOTLAND = {}